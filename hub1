######################################################################
#IPSec phase 1 , phase 2
######################################################################
config vpn ipsec phase1-interface
    edit advpn-hub1
        set type dynamic
        set interface port2
        set peertype any
        set net-device disable
        set proposal des-sha256 des-sha1
        set add-route disable
        set dpd on-idle
        set auto-discovery-sender enable
        set psksecret sample
        set dpd-retryinterval 5
    next
end
config vpn ipsec phase2-interface
    edit advpn-hub1
        set phase1name advpn-hub1
        set proposal des-sha256 des-sha1
    next
end

######################################################################
#FIREWALL POLICIES
######################################################################
config firewall policy
    edit 1
        set name "spoke2hub"
        set srcintf advpn-hub1
        set dstintf internal_lan
        set srcaddr all
        set dstaddr all
        set action accept
        set schedule always
        set service ALL
    next
    edit 2
        set name "spoke2spoke"
        set srcintf advpn-hub1
        set dstintf advpn-hub1
        set srcaddr all
        set dstaddr all
        set action accept
        set schedule always
        set service ALL
    next
end   

######################################################################
#IPSEC TUNNEL INTERFACE IP ADDRESS  _ SPOKE
######################################################################
config system interface
    edit advpn-hub1
        set vdom root
        set ip 10.10.10.254 255.255.255.255
        set remote-ip 10.10.10.253 255.255.255.0
    next
end

######################################################################
#CONFIG THE HUB FORTIGATE BGP
######################################################################

config router bgp
    set as 65412
    config neighbor-group
        edit advpn
            set link-down-failover enable
            set remote-as 65412
            set route-reflector-client enable
        next
    end
    config neighbor-range
        edit 1
            set prefix 10.10.10.0 255.255.255.0
            set neighbor-group "advpn"
        next
    end
    config network
        edit 1
            set prefix 172.150.1.0 255.255.255.192
        next
        edit 2
            set prefix 172.150.1.64 255.255.255.224
        next
        edit 3
            set prefix 172.150.1.112 255.255.255.240
        next
    end
end