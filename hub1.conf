#CONFIG SYS INT : LAN , WAN , VLANs 
#CONFIG SYS INT : VLANS & TUNNEL INT:
#CONFIG SYS INT : CONNECT TO INTERNET GUI
#CONFIG STATIC ROUTE
#CONFIGURE LAN ZONE 
#CONFIGURE VPN IPSEC PH1 & PH2
#CONFIG ROUTER BGP
########################################################################################################CONFIGURE INTERFACES VLANs and WAN 
#CONFIG SYS INT :  LAN , WAN , VLANs 
#######################################################################################################
 config system interface
                edit port2
                    set vdom "root"
                    set ip 192.162.254.2 255.255.255.0
                    set allowaccess ping https ssh snmp fgfm
                    set type physical
                    set alias "wan 1 for ISP1"
                    set lldp-reception enable
                    set role wan
                    set snmp-index 2
                    
                next
                edit port4
                    set vdom "root"
                    set ip 12.1.254.2 255.255.255.0
                    set allowaccess ping https ssh snmp fgfm
                    set type physical
                    set alias "wan 2 for ISP2"
                    set lldp-reception enable
                    set role wan
                    set snmp-index 4
                next
end

#######################################################################################################
#CONFIG SYS INT : VLANS & TUNNEL INT:
#######################################################################################################
config system interface
edit "VLAN_40"
        set vdom "root"
        set ip 172.150.1.1 255.255.255.192
        set allowaccess ping https ssh snmp
        set alias "vlan40"
        set device-identification enable
        set role lan
        set snmp-index 13
        set interface "port3"
        set vlanid 40
    next
    edit "VLAN_101"
        set vdom "root"
        set ip 172.150.1.65 255.255.255.224
        set allowaccess ping https ssh snmp
        set alias "vlan101"
        set device-identification enable
        set role lan
        set snmp-index 14
        set interface "port3"
        set vlanid 101
    next
    edit "VLAN_99"
        set vdom "root"
        set ip 172.150.1.113 255.255.255.240
        set allowaccess ping ssh snmp fgfm ftm
        set alias "native"
        set device-identification enable
        set role lan
        set snmp-index 15
        set interface "port3"
        set vlanid 99
    next
    edit "advpn-hub1"
        set vdom "root"
        set ip 10.10.10.1 255.255.255.255
        set allowaccess ping
        set type tunnel
        set remote-ip 10.10.10.254 255.255.255.0
        set snmp-index 16
        set interface "port2"
    next
    edit "advpn2-hub1"
        set vdom "root"
        set ip 10.10.20.1 255.255.255.255
        set allowaccess ping
        set type tunnel
        set remote-ip 10.10.20.254 255.255.255.0
        set snmp-index 17
        set interface "port4"
    next
end

#######################################################################################################
#CONNECT TO INTERNET GUI
#######################################################################################################
config system interface
    edit port10
        set mode static 
        set vdom "root"
        set ip 192.168.1.200 255.255.255.0
        set allowaccess ping https ssh http
        set type physical
        set snmp-index 10
    next
end
#######################################################################################################
#CONFIG STATIC ROUTE
#######################################################################################################
config router static
    edit 1
        set dst 192.162.0.0 255.255.0.0
        set gateway 192.162.254.1
        set device "port2"
    next
    edit 2
        set dst 12.1.0.0 255.255.0.0
        set gateway 12.1.254.1
        set device "port4"
    next
end  
#######################################################################################################
#CONFIGURE ROUTE STATICS
#######################################################################################################
config system dhcp server
    edit 1
        set ntp-service local
        set default-gateway 10.255.1.1
        set netmask 255.255.255.0
        set interface "fortilink"
        config ip-range
            edit 1
                set start-ip 10.255.1.2
                set end-ip 10.255.1.254
            next
        end
        set vci-match enable
        set vci-string "FortiSwitch" "FortiExtender"
    next
    edit 2
        set dns-service default
        set default-gateway 172.150.1.113
        set netmask 255.255.255.240
        set interface "VLAN_99"
        config ip-range
            edit 1
                set start-ip 172.150.1.114
                set end-ip 172.150.1.126
            next
        end
    next
    edit 3
        set dns-service default
        set default-gateway 172.150.1.65
        set netmask 255.255.255.224
        set interface "VLAN_101"
        config ip-range
            edit 1
                set start-ip 172.150.1.66
                set end-ip 172.150.1.94
            next
        end
    next
    edit 3
        set dns-service default
        set default-gateway 172.150.1.65
        set netmask 255.255.255.224
        set interface "VLAN_101"
        config ip-range
            edit 1
                set start-ip 172.150.1.66
                set end-ip 172.150.1.94
            next
        end
    next
    edit 4
        set dns-service default
        set default-gateway 172.150.1.1
        set netmask 255.255.255.192
        set interface "VLAN_40"
        config ip-range
            edit 1
                set start-ip 172.150.1.2
                set end-ip 172.150.1.62
            next
        end
    next
end
#######################################################################################################
#CONFIG LAN ZONE 
#######################################################################################################
config system zone
    edit "internal_lan"
        set intrazone allow
        set interface "VLAN_40" "VLAN_99" "VLAN_101"
    next
end
#######################################################################################################
#CONFIG VPN IPSEC PH1 & PH2
#######################################################################################################
config vpn ipsec phase1-interface
    edit "advpn-hub1"
        set type dynamic
        set interface "port2"
        set ike-version 2
        set peertype any
        set net-device disable
        set proposal des-sha1 des-sha384 des-sha512 des-md5 des-sha256
        set add-route disable
        set auto-discovery-sender enable
        set fec-egress enable
        set fec-ingress enable
        set psksecret ENC UmPn5y/feXfRRLzeWnsA3ceo/wkbR43CFffITdS3kRpiZMIs6V/EgnnldnlQKeHU14c5pW7VIL2U6XBkxIdjP8uV4lcW21rHMMAn2OxFQXgedRF0xiTashSZGD6ZTJ1YAHZV0wTU1QhQV9WP5EsPXxcvDJJNj4MCSYzdGHSTCIwOhG8OebA8hobZRvSh4CAM3+LpUg==
        set dpd-retryinterval 5
    next
    edit "advpn2-hub1"
        set type dynamic
        set interface "port4"
        set ike-version 2
        set peertype any
        set net-device disable
        set proposal des-sha1 des-sha384 des-sha512 des-md5 des-sha256
        set add-route disable
        set auto-discovery-sender enable
        set fec-egress enable
        set fec-ingress enable
        set psksecret ENC Eaz2NClFZZWOh7f108drXu6w50gK5uA/fKovjggeR57K2VvpCnO97tqvvoVwdetgnhzvU3zFCsD00xiVpt6VFihrru97rgKqsAdJXv3XkNw984Q846BmWaZtLakRfPiYlwvjh1SPSJKTmAq0OODAvOAssaLtUncaorRbqfTIPD3b3KXja+2CivvbP39dtYQcU1ZB3A==
        set dpd-retryinterval 5
    next
end
config vpn ipsec phase2-interface
    edit advpn-hub1
        set phase1name "advpn-hub1"
        set proposal des-sha256 des-sha1
    next
    edit advpn2-hub1
        set phase1name "advpn2-hub1"
        set proposal des-sha256 des-sha1
    next
end


#######################################################################################################
#CONFIG ROUTER BGP
#######################################################################################################
config router bgp
    set as 65412
    set router-id 11.11.11.11
    set ibgp-multipath enable
    set additional-path enable
    config neighbor-group
        edit "advpn"
            set link-down-failover enable
            set remote-as 65412
            set additional-path both
            set route-reflector-client enable
        next
        edit "advpn1_2"
            set capability-dynamic enable
            set link-down-failover enable
            set remote-as 65412
            set additional-path both
            set route-reflector-client enable
        next
    end
    config neighbor-range
        edit 1
            set prefix 10.10.10.0 255.255.255.0
            set neighbor-group "advpn"
        next
        edit 2
            set prefix 10.10.20.0 255.255.255.0
            set neighbor-group "advpn1_2"
        next
    end
    config network
        edit 1
            set prefix 172.150.1.0 255.255.255.192
        next
        edit 2
            set prefix 172.150.1.64 255.255.255.224
        next
        edit 3
            set prefix 172.150.1.112 255.255.255.240
        next
    end
    config network6
        edit 1
            set prefix6 ::/128
        next
    end
    config redistribute "connected"
    end
    config redistribute "rip"
    end
    config redistribute "ospf"
    end
    config redistribute "static"
    end
    config redistribute "isis"
    end
    config redistribute6 "connected"
    end
    config redistribute6 "rip"
    end
    config redistribute6 "ospf"
    end
    config redistribute6 "static"
    end
    config redistribute6 "isis"
    end
end
config router isis
    config redistribute "connected"
    end
    config redistribute "rip"
    end
    config redistribute "ospf"
    end
    config redistribute "bgp"
    end
    config redistribute "static"
    end
    config redistribute6 "connected"
    end
    config redistribute6 "rip"
    end
    config redistribute6 "ospf"
    end
    config redistribute6 "bgp"
    end
    config redistribute6 "static"
    end
end
config router multicast
end
#######################################################################################################
#FIREWALL POLICY
#######################################################################################################
config firewall policy
    edit 1
        set name "in"
        set uuid 11912afa-09f0-51ec-3784-0a1345305b0b
        set srcintf "advpn-hub1" "advpn2-hub1"
        set dstintf "internal_lan"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
    next
    edit 3
        set name "s-s"
        set uuid 1f722534-09f0-51ec-01dc-a475549211d4
        set srcintf "advpn-hub1" "advpn2-hub1"
        set dstintf "advpn2-hub1" "advpn-hub1"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
        set comments " (Copy of in) (Reverse of in) (Copy of 2) (Reverse of 2)"
    next
    edit 2
        set name "out"
        set uuid 1c85ea18-09f0-51ec-c0a4-99b8499f3480
        set srcintf "internal_lan"
        set dstintf "advpn-hub1" "advpn2-hub1"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
    next
    edit 4
        set name "internal_lan"
        set uuid 95c383f0-0a21-51ec-e3fb-abe15dc4d75f
        set srcintf "internal_lan"
        set dstintf "internal_lan"
        set srcaddr "all"
        set dstaddr "all"
        set action accept
        set schedule "always"
        set service "ALL"
    next
end