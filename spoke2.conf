########################################################################################################CONFIGURE INTERFACES VLANs and WAN 
#CONFIG LAN , WAN , VLANs 
#######################################################################################################
 config system interface
                edit port2
                    set allowaccess ping https ssh fgfm
                    set type physical
                    set alias "wan1"
                    set lldp-reception enable
                    set role wan
                    set snmp-index 2
                next
                edit port4
                    set ip 12.1.1.2 255.255.255.0
                    set allowaccess ping https ssh snmp fgfm
                    set type physical
                    set alias "wan2"
                    set lldp-reception enable
                    set role wan
                    set snmp-index 4
                next
end
########################################################################################################C
#CONFIG SYS INT : VLANS & TUNNEL INT:
########################################################################################################C
config system interface
    edit "VLAN_40"
        set vdom "root"
        set ip 172.150.3.1 255.255.255.192
        set allowaccess ping https ssh snmp
        set alias "vlan40"
        set device-identification enable
        set role lan
        set snmp-index 14
        set interface "port3"
        set vlanid 40
    next
    edit "VLAN_101"
        set vdom "root"
        set ip 172.150.3.65 255.255.255.224
        set allowaccess ping https ssh snmp
        set alias "vlan101"
        set device-identification enable
        set role lan
        set snmp-index 15
        set interface "port3"
        set vlanid 101
    next
    edit "VLAN_99"
        set vdom "root"
        set ip 172.150.3.112 255.255.255.224
        set allowaccess ping https ssh snmp
        set alias "native"
        set device-identification enable
        set role lan
        set snmp-index 13
        set interface "port3"
        set vlanid 99
    next
    edit "spoke2"
        set vdom "root"
        set ip 10.10.10.2 255.255.255.255
        set allowaccess ping
        set type tunnel
        set remote-ip 10.10.10.1 255.255.255.0
        set snmp-index 16
        set interface "port2"
    next
    edit "spoke2_backup"
        set vdom "root"
        set ip 10.10.20.2 255.255.255.255
        set allowaccess ping
        set type tunnel
        set remote-ip 10.10.20.1 255.255.255.0
        set snmp-index 17
        set interface "port4"
    next
end
#######################################################################################################
#CONFIG SYS INT : CONNECT TO INTERNET GUI
#######################################################################################################
config system interface
    edit port10
            set mode static 
            set vdom "root"
            set ip 192.168.1.102 255.255.255.0
            set allowaccess ping https ssh http
            set type physical
            set snmp-index 10
    next
end
#######################################################################################################
#CONFIG STATIC ROUTE
#######################################################################################################
config router static
    edit 1
        set dst 12.1.254.2 255.255.255.255
        set gateway 12.1.1.1
        set distance 15
        set device "port4"
    next
    edit 2
        set dst 192.162.254.2 255.255.255.255
        set gateway 192.162.11.1
        set device "port2"
    next
end
#######################################################################################################
#CONFIGURE LAN ZONE 
#######################################################################################################
config system zone
    edit beta_lan
        set interface internal VLAN_101
        set interface internal VLAN_40
        set interface internal VLAN_99
        set intrazone allow
    next
end
#######################################################################################################
#CONFIG DHCP
pool vlan-10 172.150.4.1 172.150.4.62   192
pool vlan-30 172.150.4.65 172.150.4.94    224
pool vlan-101 172.150.4.97 172.150.4.110 240
pool native 172.150.2.113 172.150.2.126 240


#######################################################################################################
#CONFIGURE VPN IPSEC PH1 & PH2
#######################################################################################################
config vpn ipsec phase1-interface
    edit "spoke2"
        set interface "port2"
        set ike-version 2
        set peertype any
        set net-device enable
        set proposal des-sha1 des-sha256 des-sha384 des-sha512 des-md5
        set add-route disable
        set dpd on-idle
        set auto-discovery-receiver enable
        set remote-gw 192.162.254.2
        set psksecret ENC i0ujCI6zhh7XQIwLvdaqCUFQ13Xb5+huI15M9NFlrkYRLih5U6qC/nt1gLP/CLTecAbDopbMJFkWWESajHV3q5dQjuwvaKRwoPnoeF/HfwbYyQTZfFlJ9iXPLEZ/SeUBckR9oWN18kI40WrJJPCC4j2dj8XvINRbAP+befacTsFwpFX8XyPRr/w051aRL7kN1CAM5Q==
        set dpd-retryinterval 5
    next
    edit "spoke2_backup"
        set interface "port4"
        set ike-version 2
        set peertype any
        set net-device enable
        set proposal des-sha1 des-sha384 des-sha512 des-md5
        set add-route disable
        set dpd on-idle
        set auto-discovery-receiver enable
        set remote-gw 12.1.254.2
        set monitor "spoke2"
        set psksecret ENC HosOvLgRfWSX1nS3Z1EoLMjt0ThBkEkl35fAKYAMIWGglVvSY2XOamcNEpv6hObQ4z+d41DCJeByJaJOHpk74bOOkq8GeP+WFtOQRY7KULl2NjsFm+LV4+9v4uzDPVmjTwNMPdY8W9PLGuI9U1O8PIRinp2YvFfdy9yEYQ+AtAN+WcJQtXQKLALh2srH/OYN9aPT0g==
        set dpd-retryinterval 5
    next
end
config vpn ipsec phase2-interface
    edit "spoke2"
        set phase1name "spoke2"
        set proposal des-sha256 des-sha1
        set auto-negotiate enable
        set src-subnet 10.10.10.0 255.255.255.0
        set dst-subnet 10.10.10.0 255.255.255.0
    next
    edit "spoke2_backup"
        set phase1name "spoke2_backup"
        set proposal des-sha256 des-sha1
        set auto-negotiate enable
        set src-subnet 10.10.20.0 255.255.255.0
        set dst-subnet 10.10.20.0 255.255.255.0
    next
end

#######################################################################################################
#CONFIG ROUTER BGP
#######################################################################################################
config router bgp
    set as 65412
    set router-id 2.2.2.2
    set ibgp-multipath enable
    config neighbor
        edit "10.10.10.1"
            set advertisement-interval 1
            set link-down-failover enable
            set interface "spoke2"
            set remote-as 65412
            set update-source "spoke2"
            set additional-path both
        next
        edit "10.10.20.1"
            set interface "spoke2_backup"
            set remote-as 65412
            set update-source "spoke2_backup"
        next
    end
    config network
        edit 1
            set prefix 172.150.3.0 255.255.255.192
        next
        edit 2
            set prefix 172.150.3.64 255.255.255.224
        next
        edit 3
            set prefix 172.150.3.96 255.255.255.224
        next
    end
    config network6
        edit 1
            set prefix6 ::/128
        next
    end
    config redistribute "connected"
    end
    config redistribute "rip"
    end
    config redistribute "ospf"
    end
    config redistribute "static"
    end
    config redistribute "isis"
    end
    config redistribute6 "connected"
    end
    config redistribute6 "rip"
    end
    config redistribute6 "ospf"
    end
    config redistribute6 "static"
    end
    config redistribute6 "isis"
    end
end
config router isis
    config redistribute "connected"
    end
    config redistribute "rip"
    end
    config redistribute "ospf"
    end
    config redistribute "bgp"
    end
    config redistribute "static"
    end
    config redistribute6 "connected"
    end
    config redistribute6 "rip"
    end
    config redistribute6 "ospf"
    end
    config redistribute6 "bgp"
    end
    config redistribute6 "static"
    end
end
config router multicast
end